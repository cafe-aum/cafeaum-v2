<div class="cy-contour-white">
  <div class="cy-contour">
    <div class="cy-container">
      <div ng-include="'/static/templates/general/navbar.html'"></div>
      <div class="main-container" style="min-height:1200px;" ng-if="!loaded">
        <md-progress-circular
                ng-disabled="data.transaction_successful"
                md-mode="indeterminate"
                style="margin: 50% auto;">
        </md-progress-circular>
      </div>
      <div class="main-container" ng-if="loaded">
        <h1 class="page-title">Bonjour {{account.first_name}}</h1>
        <h3 class="text-centered">Votre crédit est de {{account.credits}} points</h3>



        <div layout="column" hide-gt-sm>
          <md-button ng-click="selectUpdateProfile()" class="md-primary">
            Mettre à jour mon profil
          </md-button>
          <md-button ng-click="selectLessonHistoric()" class="md-primary">
            Voir mon historique de cours
          </md-button>
          <md-button ng-click="selectTransactionHistoric()" class="md-primary">
            Voir mon historique de transaction
          </md-button>
        </div>
        <div layout="column" style="height: 600px; margin-top:55px;" ng-cloak>
          <div layout="row" flex style="font-size:25px;">
            <div ng-include="'/static/templates/general/sidenav.html'"></div>

            <md-content flex layout-padding style="background-color:#fffdfa;">

              <div layout="column" layout-align="top center">

                <div ng-if="state.showUpdateProfile" style="width: 50%;" layout-align="top center">
                  <h3 class="text-centered"> Votre profil :</h3>
                  <form  role="form" class="update-account-form" ng-submit="updateProfile()">
                    <div  class="alert alert-danger" ng-show="error" ng-bind="error"/>
                    <div  class="alert alert-success" ng-show="success" ng-bind="success"/>
                    <div class="form-group settings-form">
                      <label for="settings_nom">Nom *</label>
                      <input name="nom"
                             type="text"
                             class="form-control"
                             id="settings_nom"
                             ng-model="updateProfileFields.first_name"
                             ng-required="1"
                             placeholder="Nom *"
                             validate-on="submit"
                             oninvalid="this.setCustomValidity('Champ obligatoire')"
                             oninput="setCustomValidity('')"
                             ng-change="changeForm()"/>

                    </div>
                    <div class="form-group settings-form">
                      <label for="settings_prenom">Prénom *</label>
                      <input name="prenom"
                             type="text"
                             class="form-control"
                             id="settings_prenom"
                             ng-model="updateProfileFields.last_name"
                             ng-required="1"
                             placeholder="Prénom *"
                             validate-on="submit"
                             oninvalid="this.setCustomValidity('Champ obligatoire')"
                             oninput="setCustomValidity('')"
                             ng-change="changeForm()"/>
                    </div>
                    <div class="form-group settings-form">
                      <label for="settings_email">Email *</label>
                      <input name="email"
                             type="email"
                             class="form-control"
                             id="settings_email"
                             ng-model="updateProfileFields.email"
                             ng-required="1"
                             placeholder="Email *"
                             oninvalid="this.setCustomValidity('Champ obligatoire')"
                             oninput="setCustomValidity('')"
                             ng-change="changeForm()"/>
                    </div>
                    <div class="form-group settings-form">
                      <label for="settings_password1">Ancien mot de passe</label>
                      <input name="pwd1"
                             type="password"
                             class="form-control"
                             id="settings_old_password"
                             ng-model="updateProfileFields.old_password"
                             ng-required="1"
                             placeholder="Ancien mot de passe *"
                             oninvalid="this.setCustomValidity('Champ obligatoire')"
                             oninput="setCustomValidity('')"
                             ng-change="changeForm()"/>
                    </div>
                    <div class="form-group settings-form">
                      <label for="settings_password1">Nouveau mot de passe</label>
                      <input name="pwd1"
                             type="password"
                             class="form-control"
                             id="settings_password1"
                             ng-model="updateProfileFields.password"
                             ng-required="1"
                             placeholder="Nouveau mot de passe *"
                             oninvalid="this.setCustomValidity('Champ obligatoire')"
                             oninput="setCustomValidity('')"
                             ng-change="changeForm()"/>
                    </div>
                    <div class="form-group settings-form">
                      <label for="settings_password2">Confirmer votre mot de passe</label>
                      <input name="pwd2"
                             type="password"
                             class="form-control"
                             id="settings_password2"
                             ng-model="updateProfileFields.confirmation_password"
                             ng-required="1"
                             placeholder="Confirmer votre mot de passe *"
                             oninvalid="this.setCustomValidity('Champ obligatoire')"
                             oninput="setCustomValidity('')"
                             ng-change="changeForm()"/>
                    </div>
                    <div class="form-group" layout="column"
                         layout-align="top center"
                         style="margin-top:15px;">
                      <md-button type="submit"
                                 class="button-type-submit md-raised md-primary">
                        Mettre à jour
                      </md-button>
                      <md-button ng-click="deleteAccount()"
                                 class="button-type-submit md-raised md-primary">
                        Supprimer mon compte
                      </md-button>
                    </div>
                  </form>
                </div>
                <div ng-if="state.showLessonHistoric" layout-align="top center">
                  <div layout="column">
                    <md-button
                            style="margin: auto auto 60px auto;"
                            ng-click="gotoCalendar()"
                            class="md-primary md-raised cy-button">
                      Nouvelle réservation
                    </md-button>
                  </div>
                  <!--<a href="/yoga/calendrier" ><h4 style="margin-bottom:60px;" class="text-centered">Nouvelle réservation</h4></a>-->

                  <h3 class="text-centered"> Votre historique de cours : </h3>
                  <div class="historic-table">
                    <table style="margin-top: 3%; width:100%;">
                      <td class="table-header"> Type </td>
                      <td class="table-header" hide-xs hide-sm hide-md> Animateur </td>
                      <td class="table-header"> Jour </td>
                      <td class="table-header"> Heure </td>
                      <td class="table-header" hide-sm hide-xs hide-md> Durée </td>
                      <td class="table-header" hide-xs> Nb de personnes </td>
                      <td class="table-header"> Annulation </td>
                      <tr style="padding:5%" ng-class="{'lesson-finished': lesson.meta.finished}" ng-repeat="lesson in reservedLessonsForAccount">
                        <td> {{ lesson.type.nom }} {{ lesson.intensity.nom }}</td>
                        <td hide-xs hide-sm hide-md> {{ lesson.animator.prenom }} {{ lesson.animator.nom }} </td>
                        <td> {{ lesson.meta.day }} </td>
                        <td> {{ lesson.meta.start }} </td>
                        <td hide-sm hide-xs hide-md> {{ lesson.duration }} min</td>
                        <td hide-xs> {{ lesson.meta.nb_persons }} </td>
                        <td>
                          <a ng-if="!lesson.meta.finished">
                            <md-icon md-font-icon="material-icons"
                                     ng-click="cancelReservation(lesson, account)">
                              delete
                            </md-icon>
                          </a>
                        </td>
                      </tr>
                    </table>
                  </div>
                </div>
                <div ng-if="state.showTransactionHistoric" layout-align="top center">
                  <h3 class="text-centered"> Votre historique de transactions : </h3>
                  <div class="historic-table">
                    <table style="margin-top: 3%; width:100%;">
                      <td class="table-header"> Id </td>
                      <td class="table-header"> Date </td>
                      <td class="table-header"> Montant </td>
                      <tr style="padding:5%"  ng-repeat="transaction in transactions">
                        <td> {{ transaction.id }} </td>
                        <td> {{ transaction.meta.date }} </td>
                        <td> {{ transaction.montant }} €</td>
                      </tr>
                    </table>
                  </div>
                </div>
                <div ng-if="state.showRecharge" layout-align="top center" style="width:100%;">
                  <div ng-controller="RechargeController as vm">
                    <h4 ng-if="state.step_formule" class="text-centered">1/ Je choisis ma formule :</h4>
                    <h4 ng-if="state.step_code_reduction" class="text-centered">2/ Je rentre mon code de réduction :</h4>
                    <h4 ng-if="state.step_payment_summary" class="text-centered">3/ Mon résumé de transaction :</h4>
                    <h4 ng-if="state.step_card_info" class="text-centered">4/ Mes informations de paiement : </h4>
                    <h4 ng-if="error && !state.step_payment_error" class="text-centered transaction-step-error">{{error}}</h4>

                    <section ng-if="state.step_formule" style="width:100%;" layout="column" flex layout-align="space-between center">
                      <div class="text-container transaction-step" style="padding:0 10%;">
                        <md-radio-group class="formule-container" ng-model="data.montant_initial" ng-change="changeFormule()">
                          <div class="row formule" style="margin-bottom:40px;" ng-repeat="formule in data.formules" ng-class="{'last-formule':$last}">
                            <md-radio-button
                                    aria-label="Choix de la formule"
                                    value="{{formule.montant}}"
                                    class="md-primary">
                            </md-radio-button>
                            <div class="formule-details">
                              <h3> Formule {{formule.nb_cours}} Cours : {{formule.montant}} €</h3>
                              <h4 style="font-style: italic; margin-top: 5%;"> {{formule.description}} </h4>
                            </div>
                          </div>
                        </md-radio-group>
                      </div>

                      <md-button
                              ng-click="chooseFormula()"
                              ng-disabled="!data.montant_initial"
                              class="md-primary md-raised cy-button">
                        Suivant
                      </md-button>
                    </section>

                    <section ng-if="state.step_code_reduction"
                             style="margin-bottom:15%;width:100%;"
                             layout="column" flex
                             layout-align="space-between center">
                      <div class="text-container transaction-step" style="padding:0 10%;">
                        <h4 ng-if="data.reduction"
                            style="margin-bottom : 1%; color: green;"
                            class="text-centered"> Votre réduction : {{ data.reduction }} % !!</h4>

                        <md-input-container style="width:20%; margin:auto;" class="md-block">Code de Réduction
                          <label></label>
                          <input style="border : 1px solid #3f3f3f;"
                                 md-no-asterisk
                                 name="reduction"
                                 ng-model="data.code_reduction"
                                 aria-label="Code de Réduction"
                                 ng-change="tryReductionCode(data.code_reduction)">
                          <div ng-messages="data.$error">
                          </div>
                        </md-input-container>
                      </div>
                      <div layout="column" layout-align="center center" flex="80">
                        <div layout layout-align="space-between center">
                          <md-button ng-click="backToFormula()"
                                     class="md-primary md-raised cy-button">
                            Précédent
                          </md-button>

                          <md-button ng-click="tryReductionCodeIfAny(data.code_reduction)"
                                     class="md-primary md-raised cy-button">
                            Suivant
                          </md-button>
                        </div>
                        <md-button ng-click="cancelPayment()"
                                   class="md-primary md-raised cy-button">
                          Annuler
                        </md-button>
                      </div>
                    </section>
                    <section ng-if="state.step_payment_summary"
                             style="margin-bottom:15%;width:100%;"
                             layout="column" flex
                             layout-align="space-between center">
                      <div class="text-container transaction-step" style="padding:0 10%;">
                        <h4 ng-if="data.reduction"
                            style="margin-bottom : 1%; color: green;"
                            class="text-centered"> Votre réduction : {{ data.reduction }} % !!</h4>
                        <div ng-if="data.montant_initial != data.montant_final" style="margin-bottom:50px;">
                          <h4 class="text-centered">Montant : <span class="radioValue">{{ data.montant_initial }} €</span> </h4>
                          <h4 class="text-centered">Réduction : <span class="radioValue">{{ data.reduction }} % </span> </h4>
                          <h4 class="text-centered">Montant final: <span class="radioValue">{{ data.montant_final }} €</span> </h4>
                        </div>
                        <div ng-if="data.montant_initial == data.montant_final" style="margin-bottom:50px;">
                          <h4 class="text-centered">Montant : <span class="radioValue">{{ data.montant_initial }} €</span> </h4>
                        </div>
                      </div>
                      <div layout="column" layout-align="center center" flex="80">
                        <div layout layout-align="space-between center">
                          <md-button ng-click="backToReductionCode()"
                                     class="md-primary md-raised cy-button">
                            Précédent
                          </md-button>
                          <md-button ng-click="gotoPaymentForm()"
                                     class="md-primary md-raised cy-button">
                            Suivant
                          </md-button>
                        </div>
                        <md-button ng-click="cancelPayment()"
                                   class="md-primary md-raised cy-button">
                          Annuler
                        </md-button>
                      </div>
                    </section>

                    <section ng-if="state.step_card_info"
                             class="text-container transaction-step"
                             style="margin-bottom:15%;width:100%;"
                             layout="column" flex
                             layout-align="space-between center">
                      <div class="text-container transaction-step" style="padding:0 10%;"><!-- class="col-md-4 col-md-offset-4" style="margin:auto;">-->
                        <!-- Test ==> Card Number : 4242-4242-4242-4242   / Expiry : 12/18 / CVC : 999 -->
                        <form layout="column" flex="80" flex-offset="10" stripe-form="stripeCallback">
                          <div ng-if="checkoutForm.card.$invalid">Error: invalid card number!</div>
                          <md-input-container>
                            <input class="input-form"
                                   ng-model="number"
                                   placeholder="N° de carte"
                                   payments-format="card"
                                   payments-validate="card"
                                   ng-change="changeCardFrom()"/>
                          </md-input-container>
                          <md-input-container>
                            <input class="input-form"
                                   ng-model="expiry"
                                   placeholder="Date d'expiration"
                                   payments-format="expiry"
                                   payments-validate="expiry"
                                   ng-change="changeCardFrom()" />
                          </md-input-container>
                          <md-input-container>
                            <input class="input-form"
                                   ng-model="cvc"
                                   placeholder="CVC"
                                   payments-format="cvc"
                                   payments-validate="cvc"
                                   ng-change="changeCardFrom()" />
                          </md-input-container>

                          <div layout="column" layout-align="center center" flex="80">
                            <div layout layout-align="center center">
                              <md-button ng-click="backToPaymentSummary()"
                                         class="md-primary md-raised cy-button">
                                Précédent
                              </md-button>
                              <md-button type="submit"
                                         ng-click="proceedTransaction()"
                                         class="md-primary md-raised cy-button">
                                Payer
                              </md-button>
                            </div>
                            <md-button ng-click="cancelPayment()"
                                       class="md-primary md-raised cy-button">
                              Annuler
                            </md-button>
                          </div>
                        </form>
                      </div>
                    </section>

                    <section ng-if="state.step_payment_in_progress"
                             class="text-container transaction-step"
                             style="margin-bottom:15%;width:100%;"
                             layout="column" flex
                             layout-align="space-between center">
                      <h4 class="text-centered" style="margin-bottom: 150px;">Transaction en cours</h4>
                      <div layout="row" layout-sm="column" layout-align="space-around">
                        <md-progress-circular style="margin:auto;margin-bottom: 150px;" ng-disabled="data.transaction_successful" md-mode="indeterminate"></md-progress-circular>
                      </div>

                    </section>

                    <section ng-if="state.step_payment_success"
                             class="text-container transaction-step"
                             style="margin-bottom: 20%;;width:100%;"
                             layout="column" flex
                             layout-align="space-between center">

                      <h4 class="text-centered transaction-step-success" style="margin-bottom: 150px;">{{ success }}  </h4>
                      <md-button ng-click="gotoCalendar()"
                                 class="md-primary md-raised cy-button">
                        Retour
                      </md-button>
                    </section>

                    <section ng-if="state.step_payment_error"
                             class="text-container transaction-step"
                             style="margin-bottom: 20%;;width:100%;"
                             layout="column" flex
                             layout-align="space-between center">

                      <h4 class="text-centered transaction-step-error" style="margin-bottom: 150px;">{{ error }}  </h4>
                      <md-button ng-click="gotoCalendar()"
                                 class="md-primary md-raised cy-button">
                        Retour
                      </md-button>
                    </section>

                    <section ng-if="false" class="text-container" style="margin-top : 0%;">
                      <div  class="row">
                        <div ng-if="!data.transaction_submitted" class="col-md-4">
                          <h4  class="text-centered"> Choisissez votre formule : </h4>
                          <md-radio-group class="formule-container" ng-model="data.montant_initial" ng-change="changeFormule()">
                            <md-radio-button ng-repeat="formule in data.formules"
                                             value="{{formule.montant}}"
                                             class="md-primary">
                              <div class="formule">
                                <h3> Formule {{formule.nb_cours}} Cours :</h3>
                                <h3> {{formule.montant}} € </h3>
                              </div>
                            </md-radio-button>
                          </md-radio-group>

                          <md-input-container style="max-width:50%;" class="md-block">Code de Réduction
                            <input style="border : 1px solid #3f3f3f;"
                                   md-no-asterisk
                                   name="reduction"
                                   ng-model="data.code_reduction"
                                   aria-label="Code de Réduction"
                                   ng-change="tryReductionCode(data.code_reduction)">
                            <div ng-messages="data.$error">
                            </div>
                          </md-input-container>

                          <div ng-if="data.montant_initial !== data.montant_final">
                            <h4>Montant : <span class="radioValue">{{ data.montant_initial }} €</span> </h4>
                            <h4>Réduction : <span class="radioValue">{{ data.reduction }} % </span> </h4>
                            <h4>Montant final: <span class="radioValue">{{ data.montant_final }} €</span> </h4>
                          </div>
                          <div ng-if="data.montant_initial === data.montant_final">
                            <h4>Montant : <span class="radioValue">{{ data.montant_initial }} €</span> </h4>
                          </div>
                          <h4 ng-if="success" style="border:1px solid green; color:green;">{{ success}}  </h4>
                        </div>

                        <md-content class="md-padding card-container" layout-xs="column" layout="row">
                          <div class="" flex-xs flex-gt-xs="50" layout="column">
                            <md-card>
                              <md-card-title>
                                <md-card-title-text style="width:100%;" fxLayout  fxLayoutAlign="space-between stretch">
                                  <span style="width:100%;" class="md-headline">Informations de carte</span>
                                </md-card-title-text>
                                <md-card-title-media>
                                  <div class="md-media-lg card-media"></div>
                                </md-card-title-media>
                              </md-card-title>
                              <md-card-content>
                                <h4 style="margin-top:10%"> Test ===> Card Number : 4242-4242-4242-4242   / Expiry : 12/18 / CVC : 999</h4>
                                <form class="flexible-col" stripe-form="stripeCallback">
                                  <div ng-if="checkoutForm.card.$invalid">Error: invalid card number!</div>
                                  <md-input-container>
                                    <input class="input-form"
                                           ng-model="number"
                                           placeholder="N° de carte"
                                           payments-format="card"
                                           payments-validate="card" />
                                  </md-input-container>
                                  <md-input-container>
                                    <input class="input-form"
                                           ng-model="expiry"
                                           placeholder="Date d'expiration"
                                           payments-format="expiry"
                                           payments-validate="expiry" />
                                  </md-input-container>
                                  <md-input-container>
                                    <input class="input-form"
                                           ng-model="cvc"
                                           placeholder="CVC"
                                           payments-format="cvc"
                                           payments-validate="cvc" />
                                  </md-input-container>
                                  <md-card-actions layout="row" layout-align="end center">
                                    <md-button type="submit">Procéder</md-button>
                                  </md-card-actions>
                                  <md-button type="submit">Submit</md-button>
                                </form>
                              </md-card-content>
                              <md-card-actions layout="row" layout-align="end center">
                                <md-button type="submit">Procéder</md-button>
                              </md-card-actions>
                            </md-card>
                          </div>
                        </md-content>



                        <div  class="col-md-4 col-md-offset-4" style="margin-left:20%;">

                          <!-- Test ==> Card Number : 4242-4242-4242-4242   / Expiry : 12/18 / CVC : 999 -->
                          <h4 style="margin-top:10%"> Test ===> Card Number : 4242-4242-4242-4242   / Expiry : 12/18 / CVC : 999</h4>
                          <form class="flexible-col" stripe-form="stripeCallback">
                            <div ng-if="checkoutForm.card.$invalid">Error: invalid card number!</div>
                            <input class="input-form"
                                   ng-model="number"
                                   placeholder="Card Number"
                                   payments-format="card"
                                   payments-validate="card" />
                            <input class="input-form"
                                   ng-model="expiry"
                                   placeholder="Expiration"
                                   payments-format="expiry"
                                   payments-validate="expiry" />
                            <input class="input-form"
                                   ng-model="cvc"
                                   placeholder="CVC"
                                   payments-format="cvc"
                                   payments-validate="cvc" />
                            <button type="submit">Submit</button>
                          </form>
                        </div>
                      </div>
                    </section>
                    <section ng-if="false"  style="margin-top : 10%; margin-bottom:30%;" class="text-container">
                      <h4 ng-if="!data.transaction_successful"  class="text-centered" style="margin-bottom : 5%; background-color:red;">Transaction en cours</h4>
                      <div layout="row" layout-sm="column" layout-align="space-around">
                        <md-progress-circular ng-disabled="data.transaction_successful" md-mode="indeterminate"></md-progress-circular>
                      </div>
                      <h4 class="text-centered" ng-if="success" style="max-width:25%; border:1px solid green; color:green; margin:auto;">{{ success}}  </h4>
                    </section>
                  </div>
                </div>


              </div>
              <div flex></div>
            </md-content>
          </div>
        </div>
      </div>
    </div>
    <div ng-include="'/static/templates/general/footer.html'"></div>
  </div>
</div>